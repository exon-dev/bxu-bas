<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Violations</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
   href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
   rel="stylesheet"
  />
  <link
   href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
   rel="stylesheet"
  />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link
   rel="stylesheet"
   href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
  />
  <style>
   body {
    font-family: "Poppins", Arial, sans-serif !important;
    background-color: #eff3fc;
    margin: 0;
    padding: 0;
    padding-right: 0 !important;
    overflow: auto !important;
   }
   .container {
    width: 80%;
    margin: 0 auto;
    padding: 20px;
    background-color: #fff;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
   }
   h4 {
    color: #333;
   }
   .table {
    margin-top: 20px;
   }
   .spinner {
    display: flex;
    justify-content: center;
    margin-top: 20px;
   }
   tr:hover {
    background-color: #f1f1f1;
   }
   .footer {
    text-align: center;
    padding: 20px;
    background-color: #f8f9fa;
    border-top: 1px solid #e9ecef;
   }
   .card {
    border-radius: 10px;
    box-shadow: 0 1px 2.94px rgba(4, 26, 55, 0.16);
    border: none;
    margin-bottom: 30px;
    transition: all 0.3s ease-in-out;
   }
   .filters {
    margin-bottom: 20px;
   }
   .table tbody tr:hover {
    background-color: rgba(0, 0, 0, 0.05);
    transition: background-color 0.2s ease;
   }
   .hover-shadow {
    transition: all 0.3s ease;
   }
   .hover-shadow:hover {
    transform: translateY(-2px);
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
   }
   .violation-item {
    transition: transform 0.2s ease;
   }
   .violation-item:hover {
    transform: translateX(5px);
   }
   .detail-item {
    padding: 0.5rem;
    background: white;
    border-radius: 0.5rem;
   }
   .badge {
    font-weight: 500;
    letter-spacing: 0.5px;
   }
   .modal-body {
    max-height: 70vh;
    overflow-y: auto;
   }
   .modal-open {
    overflow: auto !important;
    padding-right: 0 !important;
   }
   .table-hover tbody tr:hover {
    background-color: rgba(0, 0, 0, 0.05) !important;
    cursor: pointer;
   }
   body.modal-open {
    overflow: hidden !important;
    padding-right: 0 !important;
   }
   .modal {
    overflow-y: hidden !important;
   }
   .modal-dialog {
    height: calc(100vh - 60px);
    margin: 30px auto;
   }
   .modal-content {
    max-height: 100%;
    display: flex;
    flex-direction: column;
   }
   .modal-body {
    overflow-y: auto;
    flex: 1;
   }
  </style>
 </head>
 <body id="violations">
  <section>
   <div class="card">
    <div class="card-body">
     <h4>Business Inspections</h4>
     <p>Inspect businesses and create violations for business violators.</p>
    </div>
   </div>
  </section>
  <div class="mt-3">
   <section class="card mt-3">
    <div class="card-body">
     <h4 class="mb-4">Filter & Search</h4>
     <div class="filters">
      <form id="filters-form">
       <div class="row g-3 align-items-end">
        <div class="col-md-4">
         <label for="business-name" class="form-label h6">Business Name</label>
         <input
          type="text"
          id="business-name"
          class="form-control h6"
          placeholder="Enter business name"
         />
        </div>
        <div class="col-md-4">
         <label for="inspection-date" class="form-label h6"
          >Inspection Date</label
         >
         <input type="date" id="inspection-date" class="form-control h6" />
        </div>
        <div class="col-md-4">
         <label for="violation" class="form-label h6">Violation</label>
         <select id="violation" class="form-select h6">
          <option value="">Select</option>
          <option value="yes">Yes</option>
          <option value="no">No</option>
         </select>
        </div>
        <div class="col-md-4">
         <label for="inspector" class="form-label h6">Inspector</label>
         <select id="inspector" class="form-select h6">
          <!-- Inspector options dynamically added here -->
         </select>
        </div>
        <div class="col-md-4">
         <label for="sort-order" class="form-label h6">Sort by Date</label>
         <select id="sort-order" class="form-select h6">
          <option value="latest">Latest to Oldest</option>
          <option value="oldest">Oldest to Latest</option>
         </select>
        </div>
        <div class="col-md-4">
         <label for="receipt-no" class="form-label h6">Receipt No:</label>
         <input
          type="text"
          class="form-control h6"
          id="receipt-no"
          placeholder="Search by violation receipt no..."
         />
        </div>
       </div>
      </form>
     </div>
     <h4 class="mt-4">Inspected Businesses</h4>
     <table class="table table-hover">
      <thead>
       <tr>
        <th>No.</th>
        <th>Business Name</th>
        <th>Business Status</th>
        <th>Inspector</th>
        <th>Inspection Date</th>
        <th>Type of Inspection</th>
        <th>With Violations</th>
       </tr>
      </thead>
      <tbody id="inspections-tbody">
       <!-- Rendered rows will be inserted here -->
      </tbody>
     </table>
     <nav>
      <ul class="pagination" id="pagination-controls"></ul>
     </nav>
    </div>
   </section>
  </div>

  <div
   class="modal fade"
   id="inspectionDetailModal"
   data-bs-backdrop="static"
   data-bs-keyboard="false"
   tabindex="-1"
   aria-labelledby="inspectionDetailModalLabel"
   aria-hidden="true"
  >
   <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
     <div class="modal-header">
      <h5 class="modal-title" id="inspectionDetailModalLabel">
       Inspection Details
      </h5>
      <button
       type="button"
       class="btn-close"
       data-bs-dismiss="modal"
       aria-label="Close"
      ></button>
     </div>
     <!-- ... rest of your modal content ... -->
    </div>
   </div>
  </div>

  <script type="module">
   import CONFIG from "/scripts/config.js";
   const apiUrl = CONFIG.API_BASE_URL;
   let recordsPerPage = 20; // Default value
   let currentPage = 1;
   let totalPages = 1;
   let inspectionsData = [];
   let inspectors = [];
   let timeoutId = null;

   const renderTable = () => {
    const inspectionsTbody = document.getElementById("inspections-tbody");
    inspectionsTbody.innerHTML = "";

    if (!inspectionsData || inspectionsData.length === 0) {
     const noDataRow = document.createElement("tr");
     noDataRow.innerHTML = `
            <td colspan="7" class="text-center">No inspections found</td>
        `;
     inspectionsTbody.appendChild(noDataRow);
     return;
    }

    inspectionsData.forEach((inspection, index) => {
     const row = document.createElement("tr");
     row.className = "inspection-row";
     row.style.cursor = "pointer";
     const actualIndex = (currentPage - 1) * recordsPerPage + index + 1;

     row.innerHTML = `
            <td>${actualIndex}</td>
            <td>${inspection.business?.business_name || "N/A"}</td>
            <td>${inspection.business?.status || "N/A"}</td>
            <td>${inspection.inspector?.first_name || ""} ${
      inspection.inspector?.last_name || "N/A"
     }</td>
            <td>${formatDate(inspection.inspection_date)}</td>
            <td>${inspection.type_of_inspection || "N/A"}</td>
            <td class="align-middle">
                <span class="badge ${
                 inspection.with_violations ? "bg-danger" : "bg-success"
                } py-2 px-3">
                    ${inspection.with_violations ? "Yes" : "No"}
                </span>
            </td>
        `;

     // Add click event listener to show inspection details
     row.addEventListener("click", () => {
      showInspectionDetails(inspection);
     });

     inspectionsTbody.appendChild(row);
    });

    renderPagination();
   };

   const formatDate = (dateString) => {
    if (!dateString) return "N/A";
    return new Date(dateString).toLocaleDateString();
   };

   const renderPagination = () => {
    const paginationControls = document.getElementById("pagination-controls");
    paginationControls.innerHTML = "";

    if (totalPages <= 1) return;

    const prevPageButton = document.createElement("li");
    prevPageButton.classList.add("page-item");
    prevPageButton.innerHTML = `
        <a class="page-link" href="#" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
        </a>
    `;
    prevPageButton.addEventListener("click", (e) => {
     e.preventDefault();
     if (currentPage > 1) changePage(currentPage - 1);
    });
    if (currentPage === 1) prevPageButton.classList.add("disabled");
    paginationControls.appendChild(prevPageButton);

    for (let i = 1; i <= totalPages; i++) {
     const pageButton = document.createElement("li");
     pageButton.classList.add("page-item");
     if (i === currentPage) pageButton.classList.add("active");
     pageButton.innerHTML = `<a class="page-link" href="#">${i}</a>`;
     pageButton.addEventListener("click", (e) => {
      e.preventDefault();
      changePage(i);
     });
     paginationControls.appendChild(pageButton);
    }

    const nextPageButton = document.createElement("li");
    nextPageButton.classList.add("page-item");
    nextPageButton.innerHTML = `
        <a class="page-link" href="#" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
        </a>
    `;
    nextPageButton.addEventListener("click", (e) => {
     e.preventDefault();
     if (currentPage < totalPages) changePage(currentPage + 1);
    });
    if (currentPage === totalPages) nextPageButton.classList.add("disabled");
    paginationControls.appendChild(nextPageButton);
   };

   const changePage = (newPage) => {
    if (newPage >= 1 && newPage <= totalPages) {
     currentPage = newPage;
     fetchInspections(currentPage);
    }
   };

   const fetchInspections = async (page = 1) => {
    try {
     const inspectionsTbody = document.getElementById("inspections-tbody");
     inspectionsTbody.innerHTML = `
            <tr>
                <td colspan="7" class="text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </td>
            </tr>
        `;

     const businessName = document.getElementById("business-name").value;
     const inspectionDate = document.getElementById("inspection-date").value;
     const violation = document.getElementById("violation").value;
     const inspector = document.getElementById("inspector").value;
     const sortOrder = document.getElementById("sort-order").value;

     const params = new URLSearchParams({
      page: page,
      ...(businessName && { business_name: businessName }),
      ...(inspectionDate && { inspection_date: inspectionDate }),
      ...(violation && { with_violations: violation }),
      ...(inspector && { inspector_id: inspector }),
      sort_order: sortOrder === "latest" ? "desc" : "asc",
     });

     const response = await fetch(
      `${apiUrl}/inspection/inspections?${params.toString()}`,
      {
       method: "GET",
       headers: {
        Accept: "application/json",
        "Content-Type": "application/json",
        Authorization: `Bearer ${localStorage.getItem("authToken")}`,
       },
      }
     );

     const data = await response.json();

     inspectionsData = data.inspections.data || [];
     totalPages = data.inspections.last_page || 1;
     currentPage = data.inspections.current_page || 1;
     recordsPerPage = data.inspections.per_page || 20;

     renderTable();
    } catch (error) {
     const inspectionsTbody = document.getElementById("inspections-tbody");
     inspectionsTbody.innerHTML = `
            <tr>
                <td colspan="7" class="text-center text-danger">
                    Error loading inspections. Please try again.
                </td>
            </tr>
        `;
    }
   };

   const fetchInspectors = async () => {
    try {
     const response = await fetch(`${apiUrl}/admin/inspectors`, {
      headers: {
       Accept: "application/json",
       "Content-Type": "application/json",
       Authorization: `Bearer ${localStorage.getItem("authToken")}`,
      },
     });

     const data = await response.json();
     const inspectorSelect = document.getElementById("inspector");

     inspectorSelect.innerHTML = '<option value="">Select Inspector</option>';

     data.inspectors.forEach((inspector) => {
      const option = document.createElement("option");
      option.value = inspector.inspector_id;
      option.textContent = `${inspector.first_name} ${inspector.last_name}`;
      inspectorSelect.appendChild(option);
     });
    } catch (error) {
     //  console.error("Error fetching inspectors:", error);
     console.log(error);
    }
   };

   const setupFilterListeners = () => {
    const filterElements = [
     "business-name",
     "inspection-date",
     "violation",
     "inspector",
     "sort-order",
    ];

    filterElements.forEach((elementId) => {
     const element = document.getElementById(elementId);
     if (element) {
      element.addEventListener("change", () => {
       clearTimeout(timeoutId);
       timeoutId = setTimeout(() => {
        currentPage = 1;
        fetchInspections(currentPage);
       }, 300);
      });

      if (element.type === "text" || element.type === "date") {
       element.addEventListener("input", () => {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(() => {
         currentPage = 1;
         fetchInspections(currentPage);
        }, 300);
       });
      }
     }
    });
   };

   const showInspectionDetails = async (inspection) => {
    // Clean up any existing modals and backdrops
    let modalElement = document.getElementById("inspectionDetailModal");
    if (modalElement) {
     const modalInstance = bootstrap.Modal.getInstance(modalElement);
     if (modalInstance) {
      modalInstance.dispose();
     }
     modalElement.remove();
    }
    // Remove any lingering backdrops
    const backdrops = document.getElementsByClassName("modal-backdrop");
    while (backdrops.length > 0) {
     backdrops[0].remove();
    }

    // Show loading state first
    const loadingModal = `
            <div class="modal fade" id="inspectionDetailModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
                <div class="modal-dialog modal-lg modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-body text-center p-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-3">Loading inspection details...</p>
                        </div>
                    </div>
                </div>
            </div>
        `;
    document.body.insertAdjacentHTML("beforeend", loadingModal);
    const modal = new bootstrap.Modal(
     document.getElementById("inspectionDetailModal")
    );
    modal.show();

    // Fetch inspection details
    const response = await fetch(
     `${apiUrl}/inspection/inspections/${inspection.inspection_id}`,
     {
      headers: {
       Accept: "application/json",
       Authorization: `Bearer ${localStorage.getItem("authToken")}`,
      },
     }
    );

    const data = await response.json();
    const inspectionDetails = data.inspection;

    // Create the detailed modal content with the new structure
    const detailedModalContent = `
    <div class="modal fade" id="inspectionDetailModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content border-0 shadow-sm">
                <div class="modal-header border-bottom-0 bg-primary bg-gradient text-white">
                    <h5 class="modal-title fw-bold" id="inspectionDetailModalLabel">
                        <i class="bi bi-clipboard2-check me-2"></i>Inspection Details
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <!-- Business Image Section -->
                    <div class="text-center mb-4">
                        <div class="position-relative d-inline-block">
                            <img src="${CONFIG.APP_URL}/storage/${
     inspectionDetails.image_url
    }" alt="Business Image" class="rounded-3 shadow-sm img-fluid" style="max-height: 200px; width: auto; object-fit: cover" onerror="this.src='/assets/images/no-image.png';">
                            <div class="position-absolute bottom-0 start-0 p-2 bg-dark bg-opacity-75 text-white rounded-bottom w-100">
                                <small>${
                                 inspectionDetails.business?.business_name ||
                                 "N/A"
                                }</small>
                            </div>
                        </div>
                    </div>

                    <div class="row g-4">
                        <!-- Business Information -->
                        <div class="col-6">
                            <div class="card soft-card">
                                <div class="card-body">
                                    <h6 class="card-title fw-bold mb-3">
                                        <i class="bi bi-building fs-4 text-primary me-2"></i>Business Information
                                    </h6>
                                    <div class="mb-3">
                                        <label class="text-muted small">Business Name</label>
                                        <p class="fw-semibold mb-2">${
                                         inspectionDetails.business
                                          ?.business_name || "N/A"
                                        }</p>
                                    </div>
                                    <div class="mb-3">
                                        <label class="text-muted small">Business Permit</label>
                                        <p class="fw-semibold mb-2">${
                                         inspectionDetails.business
                                          ?.business_permit || "N/A"
                                        }</p>
                                    </div>
                                    <div class="">
                                        <label class="text-muted small">Business Status</label>
                                        <p class="mb-0">
                                            <span class="fw-semibold">${
                                             inspectionDetails.business
                                              ?.status || "N/A"
                                            }</span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Owner Information -->
                        <div class="col-md-6">
                            <div class="card soft-card">
                                <div class="card-body">
                                    <h6 class="card-title fw-bold mb-3">
                                        <i class="bi bi-person fs-4 text-primary me-2"></i>Owner Information
                                    </h6>
                                    <div class="mb-3">
                                        <label class="text-muted small">Owner Name</label>
                                        <p class="fw-semibold mb-2">${
                                         inspectionDetails.business?.owner
                                          ?.first_name || ""
                                        } ${
     inspectionDetails.business?.owner?.last_name || "N/A"
    }</p>
                                    </div>
                                    <div class="mb-3">
                                        <label class="text-muted small">
                                            <i class="bi bi-envelope-fill me-1"></i>Email
                                        </label>
                                        <p class="fw-semibold mb-2">${
                                         inspectionDetails.business?.owner
                                          ?.email || "N/A"
                                        }</p>
                                    </div>
                                    <div>
                                        <label class="text-muted small">
                                            <i class="bi bi-telephone-fill me-1"></i>Phone
                                        </label>
                                        <p class="fw-semibold mb-0">${
                                         inspectionDetails.business?.owner
                                          ?.phone_number || "N/A"
                                        }</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Location Card -->
                        <div class="col-12">
                            <div class="card soft-card mb-4">
                                <div class="card-body">
                                    <div class="d-flex align-items-center mb-3">
                                        <i class="bi bi-geo-alt-fill fs-4 text-danger me-2"></i>
                                        <h6 class="card-title fw-bold mb-0">Business Location</h6>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-2">
                                                <label class="text-muted small">Street Address</label>
                                                <p class="fw-semibold mb-1">${
                                                 inspectionDetails.business
                                                  ?.address?.street_address ||
                                                 "N/A"
                                                }</p>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-2">
                                                <label class="text-muted small">City</label>
                                                <p class="fw-semibold mb-1">${
                                                 inspectionDetails.business
                                                  ?.address?.city || "N/A"
                                                }</p>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-2">
                                                <label class="text-muted small">Postal Code</label>
                                                <p class="fw-semibold mb-1">${
                                                 inspectionDetails.business
                                                  ?.address?.postal_code ||
                                                 "N/A"
                                                }</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Inspection Details -->
                        <div class="col-12">
                            <div class="card soft-card">
                                <div class="card-body">
                                    <h6 class="card-title fw-bold mb-3">
                                        <i class="bi bi-clipboard-data fs-4 text-primary me-2"></i>Inspection Details
                                    </h6>
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label class="text-muted small">Inspection Date</label>
                                            <p class="fw-semibold mb-0">${formatDate(
                                             inspectionDetails.inspection_date
                                            )}</p>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="text-muted small">Type of Inspection</label>
                                            <p class="fw-semibold mb-0">${
                                             inspectionDetails.type_of_inspection ||
                                             "N/A"
                                            }</p>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="text-muted small">Inspector</label>
                                            <p class="fw-semibold mb-0">${
                                             inspectionDetails.inspector
                                              ?.first_name || ""
                                            } ${
     inspectionDetails.inspector?.last_name || "N/A"
    }</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Violations Section -->
                        ${
                         Array.isArray(inspectionDetails.violations)
                          ? inspectionDetails.violations
                             .map(
                              (violation) => `
                                <div class="col-12">
                                    <div class="card soft-card">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-center mb-4">
                                                <div class="d-flex align-items-center">
                                                    <i class="bi bi-clipboard-x fs-4 ${
                                                     violation.status?.toLowerCase() ===
                                                     "resolved"
                                                      ? "text-success"
                                                      : "text-danger"
                                                    } me-2"></i>
                                                    <h6 class="card-title fw-bold mb-0">Violation Information</h6>
                                                </div>
                                                <span class="badge ${
                                                 violation.status?.toLowerCase() ===
                                                 "pending"
                                                  ? "bg-warning"
                                                  : violation.status?.toLowerCase() ===
                                                    "resolved"
                                                  ? "bg-success"
                                                  : violation.status?.toLowerCase() ===
                                                    "overdue"
                                                  ? "bg-danger"
                                                  : "bg-secondary"
                                                } rounded-pill px-3 py-2">
                                                    ${
                                                     violation.status?.toUpperCase() ||
                                                     "N/A"
                                                    }
                                                </span>
                                            </div>

                                            <div class="row g-4">
                                                <!-- Key Information -->
                                                <div class="col-12">
                                                    <div class="p-3 bg-light rounded-3 border-start ${
                                                     violation.status?.toLowerCase() ===
                                                     "resolved"
                                                      ? "border-success"
                                                      : "border-danger"
                                                    } border-4">
                                                        <div class="row g-3">
                                                            <div class="col-md-3">
                                                                <div class="detail-item">
                                                                    <label class="text-muted small d-block">Receipt No.</label>
                                                                    <span class="fw-semibold">${
                                                                     violation.violation_receipt_no ||
                                                                     "N/A"
                                                                    }</span>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <div class="detail-item">
                                                                    <label class="text-muted small d-block">Violation Date</label>
                                                                    <span class="fw-semibold">${formatDate(
                                                                     violation.violation_date
                                                                    )}</span>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <div class="detail-item">
                                                                    <label class="text-muted small d-block">Due Date</label>
                                                                    <span class="fw-semibold">${formatDate(
                                                                     violation.due_date
                                                                    )}</span>
                                                                </div>
                                                            </div>
                                                                    ${
                                                                     violation.days_overdue &&
                                                                     violation.status?.toLowerCase() !==
                                                                      "resolved"
                                                                      ? `<div class="col-md-3">
                                                                            <div class="detail-item">
                                                                                <label class="text-muted small d-block">Days Overdue</label>
                                                                                <span class="fw-semibold text-danger">
                                                                                    <i class="bi bi-exclamation-triangle-fill me-1"></i>
                                                                                    ${violation.days_overdue} days
                                                                                </span>
                                                                            </div>
                                                                        </div>`
                                                                      : ""
                                                                    }
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Nature of Violations -->
                                                <div class="col-12">
                                                    <div class="violations-list p-3 ${
                                                     violation.status?.toLowerCase() ===
                                                     "resolved"
                                                      ? "bg-success bg-opacity-10"
                                                      : "bg-danger bg-opacity-10"
                                                    } rounded-3">
                                                        <div class="d-flex align-items-center mb-3">
                                                            <i class="bi bi-exclamation-diamond-fill ${
                                                             violation.status?.toLowerCase() ===
                                                             "resolved"
                                                              ? "text-success"
                                                              : "text-danger"
                                                            } me-2"></i>
                                                            <h6 class="fw-bold mb-0">Nature of Violations</h6>
                                                        </div>
                                                        <div class="ps-4">
                                                            ${
                                                             Array.isArray(
                                                              violation.nature_of_violation
                                                             )
                                                              ? `<div class="row g-2">
                                                                    ${violation.nature_of_violation
                                                                     .map(
                                                                      (
                                                                       nature
                                                                      ) => `
                                                                        <div class="col-md-6">
                                                                            <div class="d-flex align-items-start">
                                                                                <i class="bi bi-dot ${
                                                                                 violation.status?.toLowerCase() ===
                                                                                 "resolved"
                                                                                  ? "text-success"
                                                                                  : "text-danger"
                                                                                } mt-1 me-2"></i>
                                                                                <span class="text-uppercase small">${nature.trim()}</span>
                                                                            </div>
                                                                        </div>
                                                                    `
                                                                     )
                                                                     .join("")}
                                                                </div>`
                                                              : `<div class="text-muted">
                                                                    <i class="bi bi-info-circle me-2"></i>No violations listed
                                                                </div>`
                                                            }
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `
                             )
                             .join("")
                          : `<div class="col-12">
                        <div class="card soft-card">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-clipboard-check fs-4 text-success me-2"></i>
                                    <h6 class="card-title fw-bold mb-0">No Violations Found</h6>
                                </div>
                            </div>
                        </div>
                    </div>`
                        }
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
`;

    // Remove loading modal and show detailed modal
    modalElement = document.getElementById("inspectionDetailModal");
    if (modalElement) {
     modalElement.remove();
    }

    document.body.insertAdjacentHTML("beforeend", detailedModalContent);
    const detailedModal = new bootstrap.Modal(
     document.getElementById("inspectionDetailModal")
    );
    detailedModal.show();

    // Clean up modal and backdrop on close
    detailedModal._element.addEventListener("hidden.bs.modal", function () {
     this.remove();
     const backdrops = document.getElementsByClassName("modal-backdrop");
     while (backdrops.length > 0) {
      backdrops[0].remove();
     }
     document.body.classList.remove("modal-open");
     document.body.style.removeProperty("padding-right");
     document.body.style.overflow = "";
    });
   };

   fetchInspectors();
   setupFilterListeners();
   fetchInspections(currentPage);

   document.addEventListener("DOMContentLoaded", () => {
    const modals = document.querySelectorAll(".modal");
    modals.forEach((modalElement) => {
     new bootstrap.Modal(modalElement);
    });
   });
  </script>
 </body>
</html>
