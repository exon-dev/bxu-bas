<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BXU BAS: Forgot Password</title>
  <!-- Add Bootstrap CSS -->
  <link
   href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
   rel="stylesheet"
   integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
   crossorigin="anonymous"
  />
  <!-- Add Poppins font -->
  <link
   href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap"
   rel="stylesheet"
  />
  <!-- Add Toastify CSS -->
  <link
   rel="stylesheet"
   href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
  />
  <style>
   body {
    font-family: "Poppins", sans-serif;
    background-color: #f8f9fa; /* Light gray background */
    height: 100vh; /* Full height */
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 0;
   }
   .card {
    border: 1px solid #dee2e6; /* Subtle border */
    border-radius: 10px; /* Rounded corners */
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* Soft shadow */
    transition: transform 0.2s; /* Smooth transition */
   }
   .card:hover {
    transform: translateY(-5px); /* Slight lift on hover */
   }
   .form-label {
    font-weight: 500; /* Bold labels */
   }
   .btn-primary {
    background-color: #007bff; /* Bootstrap primary color */
    border: none;
   }
   .btn-primary:hover {
    background-color: #0056b3; /* Darker shade on hover */
   }
   .text-center a {
    color: #007bff; /* Bootstrap link color */
   }
   .text-center a:hover {
    text-decoration: underline; /* Underline on hover */
   }
   .spinner-border {
    display: none; /* Initially hidden */
   }
  </style>
 </head>
 <body>
  <div class="container">
   <div class="row justify-content-center">
    <div class="col-lg-6">
     <div class="card p-5">
      <h4 class="card-title text-center mb-4">Forgot Password</h4>
      <form id="forgotPasswordForm">
       <div class="mb-3">
        <label for="email" class="form-label">Email</label>
        <input type="email" class="form-control" id="email" required />
       </div>
       <button type="submit" class="btn btn-primary w-100">
        Send Reset Link
        <span
         class="spinner-border spinner-border-sm ms-2"
         role="status"
         aria-hidden="true"
        ></span>
       </button>
      </form>
      <div class="text-center mt-3">
       <a href="index.html" class="text-decoration-none">Back to Login</a>
      </div>
     </div>
    </div>
   </div>
  </div>

  <!-- Add Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Add Toastify JS -->
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <script type="module">
   import CONFIG from "/scripts/config.js";
   const apiUrl = CONFIG.API_BASE_URL;
   const forgotPasswordForm = document.getElementById("forgotPasswordForm");

   // Retrieve the role from URL parameters
   const urlParams = new URLSearchParams(window.location.search);
   const role = urlParams.get("role"); // Get the role from the URL

   forgotPasswordForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const email = document.getElementById("email").value;
    const spinner = document.querySelector(".spinner-border");

    // Show the spinner
    spinner.style.display = "inline-block";

    try {
     const response = await fetch(apiUrl + "/auth/change-password-request", {
      method: "POST",
      headers: {
       Accept: "application/json",
       "Content-Type": "application/json",
      },
      body: JSON.stringify({ email, role }), // Include the role in the body
     });

     const data = await response.json();

     // Hide the spinner
     spinner.style.display = "none";

     if (response.ok) {
      Toastify({
       text: "Reset link sent to your email!",
       duration: 3000,
       gravity: "top",
       position: "center",
       close: true,
      }).showToast();
     } else {
      Toastify({
       text: data.message || "Error sending reset link",
       duration: 3000,
       gravity: "top",
       position: "center",
       close: true,
       style: {
        background: "red",
       },
      }).showToast();
     }
    } catch (err) {
     // Hide the spinner
     spinner.style.display = "none";

     Toastify({
      text: "Internal server error, please try again later",
      duration: 3000,
      gravity: "top",
      position: "center",
      close: true,
      style: {
       background: "red",
      },
     }).showToast();
    }
   });
  </script>
 </body>
</html>
