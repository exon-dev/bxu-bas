<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BXU BAS: Dashboard</title>
  <link
   href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
   rel="stylesheet"
  />
  <link
   href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css"
   rel="stylesheet"
  />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
   href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
   rel="stylesheet"
  />
  <link
   rel="stylesheet"
   href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.3.0/css/all.min.css"
   integrity="sha512-UJqci0ZyYcQ0AOJkcIkUCxLS2L6eNcOr7ZiypuInvEhO9uqIDi349MEFrqBzoy1QlfcjfURHl+WTMjEdWcv67A=="
   crossorigin="anonymous"
   referrerpolicy="no-referrer"
  />
  <link rel="stylesheet" href="/css/admin/dashboard.css" />
  <style>
   body {
    font-family: "Poppins", sans-serif !important;
    background-color: #eff3fc;
   }
   .card {
    border: none;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
   }
   .order-card {
    color: #fff;
   }
   .bg-c-pink {
    background: #ff5370;
   }
   .bg-c-blue {
    background: #4099ff;
   }
   .bg-c-green {
    background: #2ed8b6;
   }
   .bg-c-yellow {
    background: #ffb64d;
   }
  </style>
 </head>
 <body id="dashboard">
  <div class="card mb-4">
   <div class="card-body">
    <h4>Dashboard</h4>
    <p>
     Welcome to the BXU BAS Dashboard. Here you can monitor and manage all
     activities related to violators and inspectors.
    </p>
   </div>
  </div>
  <div class="row">
   <div class="col-md-4 col-xl-3">
    <div class="card bg-c-pink order-card">
     <div class="card-body">
      <h6 class="mb-2">Total Inspectors</h6>
      <div class="d-flex align-items-center gap-2">
       <i class="fa fa-user-tie text-white" aria-label="Inspectors Icon"></i>
       <h2 id="total_inspectors">0</h2>
      </div>
     </div>
    </div>
   </div>
   <div class="col-md-4 col-xl-3">
    <div class="card bg-c-blue order-card">
     <div class="card-body">
      <h6 class="mb-2">Total Inspections</h6>
      <div class="d-flex align-items-center gap-2">
       <i class="fa fa-users text-white" aria-label="Inspections Icon"></i>
       <h2 id="total_inspections">0</h2>
      </div>
     </div>
    </div>
   </div>
   <div class="col-md-4 col-xl-3">
    <div class="card bg-c-green order-card">
     <div class="card-body">
      <h6 class="mb-2">Total Violations</h6>
      <div class="d-flex align-items-center gap-2">
       <i
        class="fa fa-check-circle text-white"
        aria-label="Violations Icon"
       ></i>
       <h2 id="total_violations">0</h2>
      </div>
     </div>
    </div>
   </div>
   <div class="col-md-4 col-xl-3">
    <div class="card bg-c-yellow order-card">
     <div class="card-body">
      <h6 class="mb-2">Overdue Violations</h6>
      <div class="d-flex align-items-center gap-2">
       <i
        class="fa fa-exclamation-triangle text-white"
        aria-label="Overdue Icon"
       ></i>
       <h2 id="overdue_violations">0</h2>
      </div>
     </div>
    </div>
   </div>
  </div>

  <script type="module">
   import CONFIG from "/scripts/config.js";

   const apiUrl = CONFIG.API_BASE_URL;

   console.log(apiUrl);

   const getCardInfo = async () => {
    try {
     const res = await fetch(apiUrl + "/dashboard/card-info", {
      method: "GET",
      headers: {
       "Content-Type": "application/json",
       Authorization: `Bearer ${localStorage.getItem("authToken")}`,
      },
     });

     console.log(res);

     if (!res.ok) {
      throw new Error(`Error: ${res.status} - ${res.statusText}`);
     }

     const data = await res.json();
     document.getElementById("total_inspectors").textContent =
      data.total_inspectors || 0;
     document.getElementById("total_inspections").textContent =
      data.total_inspections || 0;
     document.getElementById("total_violations").textContent =
      data.total_violations || 0;
     document.getElementById("overdue_violations").textContent =
      data.overdue_violations || 0;
    } catch (error) {
     console.error(error.message);
     alert("Failed to load dashboard data. Please try again later.");
    }
   };

   // Fetch data on page load
   getCardInfo();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
 </body>
</html>
